<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<title>Pelatihan PT SSI</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
body {
    background: linear-gradient(to bottom right, #fff8e6, #f6e7c5);
    font-family: 'Segoe UI', sans-serif;
}
.mainbox { max-width: 1200px; margin:auto; }
.card { border-radius:16px; border:none; }
.card-header {
    background:#d4af37;
    color:#fff;
    font-weight:600;
    border-radius:16px 16px 0 0;
}
.hidden{display:none}
.soal-box{
    background:#fff;
    padding:18px;
    border-radius:12px;
    border:1px solid #e3d7ac;
    margin-bottom:15px;
}
#loadingOverlay{
    position:fixed;
    inset:0;
    background:rgba(255,255,255,.85);
    display:none;
    justify-content:center;
    align-items:center;
    z-index:9999;
}
</style>
</head>

<body>

<!-- LOADING -->
<div id="loadingOverlay">
    <div class="text-center">
        <div class="spinner-border"></div>
        <p class="mt-3 fw-bold">Mengambil soal...</p>
    </div>
</div>

<div class="container mainbox py-4">

<h3 class="text-center fw-bold">Pelatihan Online PT SSI</h3>
<h5 class="text-center mb-4">Module Kaset ATM</h5>

<!-- FORM PESERTA -->
<div id="formPeserta" class="card shadow">
<div class="card-header">Data Peserta</div>
<div class="card-body">

<input id="nama" class="form-control mb-3" placeholder="Nama Pegawai">
<input id="npp" class="form-control mb-3" placeholder="NPP">

<select id="region" class="form-select mb-3">
<option value="">-- Pilih Region --</option>
<option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
<option>6</option><option>7</option><option>8</option><option>9</option><option>10</option>
</select>

<input id="unit" class="form-control mb-3" placeholder="Unit (contoh: TWU Bekasi)">

<select id="jabatan" class="form-select mb-4">
<option value="">-- Jabatan --</option>
<option>GM</option><option>Manager</option><option>Staf</option>
</select>

<button class="btn btn-danger w-100 fw-bold" onclick="mulaiPostTest()">Mulai Post Test</button>
</div>
</div>

<!-- KUIS -->
<div id="kuisBox" class="hidden mt-4">
<div class="card shadow">
<div class="card-header">Post Test</div>
<div class="card-body">
<div id="listSoal"></div>
<button class="btn btn-primary w-100 fw-bold" onclick="kumpulkan()">Kumpulkan Jawaban</button>
</div>
</div>
</div>

<!-- HASIL -->
<div id="hasilBox" class="hidden mt-4 card shadow p-4 text-center">
<h4 id="tampilNilai"></h4>
<button id="btnCetak" class="btn btn-warning mt-3 hidden" onclick="cetakSertifikat()">Cetak Sertifikat</button>
<button id="btnUlang" class="btn btn-danger mt-3 hidden" onclick="ulangKuis()">Ulangi Post Test</button>
</div>

</div>

<script>
const WEBAPP = "https://script.google.com/macros/s/AKfycbwZx-yp9jwHD1fYlreRWWwMIT3Hwq6UXbK_KRISJQaYHFqYt0JO26K_mbX76LEPDa0x/exec";

const formPeserta = document.getElementById("formPeserta");
const kuisBox = document.getElementById("kuisBox");
const hasilBox = document.getElementById("hasilBox");
const btnCetak = document.getElementById("btnCetak");
const btnUlang = document.getElementById("btnUlang");
const tampilNilai = document.getElementById("tampilNilai");
const listSoal = document.getElementById("listSoal");
const loadingOverlay = document.getElementById("loadingOverlay");

let DATA_SOAL = [];
let USER = {};

async function mulaiPostTest(){
    USER.nama = nama.value;
    USER.npp = npp.value;
    USER.region = region.value;
    USER.unit = unit.value;
    USER.jabatan = jabatan.value;

    if(!USER.nama || !USER.npp){
        alert("Nama & NPP wajib diisi");
        return;
    }

    fetch(WEBAPP+"?action=simpandata",{method:"POST",body:JSON.stringify(USER)});
    formPeserta.classList.add("hidden");
    loadingOverlay.style.display="flex";

    const res = await fetch(WEBAPP+"?action=getsoal");
    DATA_SOAL = await res.json();

    let html="";
    DATA_SOAL.forEach((s,i)=>{
        html+=`
        <div class="soal-box">
            <b>${i+1}. ${s.soal}</b><br><br>
            ${["A","B","C","D"].map(p=>`
                <label class="d-block">
                <input type="radio" name="soal${i}" value="${p}">
                ${p}. ${s["opsi"+p]}
                </label>
            `).join("")}
        </div>`;
    });

    listSoal.innerHTML = html;
    loadingOverlay.style.display="none";
    kuisBox.classList.remove("hidden");
}

function kumpulkan(){
    let benar=0;
    DATA_SOAL.forEach((s,i)=>{
        const j=document.querySelector(`input[name=soal${i}]:checked`);
        if(j && j.value===s.kunci) benar++;
    });

    USER.nilai = Math.round((benar/DATA_SOAL.length)*100);
    fetch(WEBAPP+"?action=simpannilai",{method:"POST",body:JSON.stringify(USER)});

    kuisBox.classList.add("hidden");
    hasilBox.classList.remove("hidden");
    tampilNilai.innerHTML=`Nilai Anda: <b>${USER.nilai}</b>`;

    btnCetak.classList.add("hidden");
    btnUlang.classList.add("hidden");

    USER.nilai>=70 ? btnCetak.classList.remove("hidden") : btnUlang.classList.remove("hidden");
}

function ulangKuis(){
    hasilBox.classList.add("hidden");
    document.querySelectorAll("input[type=radio]").forEach(r=>r.checked=false);
    kuisBox.classList.remove("hidden");
}


function cetakSertifikat() {

const cert = `
<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Sertifikat Kelulusan</title>

<style>
@page {
    size: A4 landscape;
    margin: 0;
}

body {
    margin: 0;
    padding: 0;
    background: linear-gradient(135deg, #f9f4e8, #f1e0b8);
    font-family: "Times New Roman", serif;
}

.certificate {
    width: 100%;
    height: 100vh;
    padding: 60px;
    box-sizing: border-box;
    border: 18px solid #d4af37;
    outline: 6px double #b8963d;
    background: #fffdf
    text-align: center;
    position: relative;
}

/* Ornamen sudut */
.orn {
    position: absolute;
    width: 120px;
    opacity: 0.4;
}
.orn.tl { top: 20px; left: 20px; }
.orn.tr { top: 20px; right: 20px; transform: scaleX(-1); }
.orn.bl { bottom: 20px; left: 20px; transform: scaleY(-1); }
.orn.br { bottom: 20px; right: 20px; transform: scale(-1); }

.title {
    font-size: 48px;
    color: #b08a2e;
    font-weight: bold;
    letter-spacing: 3px;
    margin-top: 40px;
}

.subtitle {
    font-size: 18px;
    color: #555;
    margin-top: 10px;
}

.line {
    width: 60%;
    height: 2px;
    background: linear-gradient(to right, transparent, #d4af37, transparent);
    margin: 25px auto;
}

.name {
    font-size: 60px;
    font-weight: bold;
    color: #8c6a1f;
    margin: 20px 0;
    text-transform: uppercase;
}

.info {
    font-size: 20px;
    color: #333;
    line-height: 1.8;
}

.score {
    font-size: 22px;
    margin-top: 20px;
    color: #000;
}

.signature-area {
    margin-top: 70px;
    display: flex;
    justify-content: space-between;
    padding: 0 80px;
}

.sign {
    text-align: center;
    font-size: 16px;
    color: #333;
}

.sign .line-sign {
    width: 220px;
    height: 1px;
    background: #333;
    margin: 40px auto 8px;
}

.footer {
    position: absolute;
    bottom: 30px;
    width: 100%;
    font-size: 14px;
    color: #666;
}
</style>
</head>

<body>

<div class="certificate">

    <!-- Ornamen (opsional, boleh hapus jika tidak ada gambar) -->
    <!-- <img src="ornamen.png" class="orn tl">
    <img src="ornamen.png" class="orn tr">
    <img src="ornamen.png" class="orn bl">
    <img src="ornamen.png" class="orn br"> -->

    <div class="title">SERTIFIKAT KELULUSAN</div>
    <div class="subtitle">Pelatihan Resmi PT Swadharma Sarana Informatika</div>

    <div class="line"></div>

    <div class="info">Dengan ini diberikan kepada:</div>

    <div class="name">${USER.nama}</div>

    <div class="info">
        NPP : <b>${USER.npp}</b><br>
        Region : <b>${USER.region}</b><br>
        Jabatan : <b>${USER.jabatan}</b>
    </div>

    <div class="score">
        Dinyatakan <b>LULUS</b> dengan nilai akhir<br>
        <span style="font-size:34px;font-weight:bold;color:#b08a2e;">
            ${USER.nilai}
        </span>
    </div>

    <div class="signature-area">
        <div class="sign">
            <div class="line-sign"></div>
            Trainer / Instruktur
        </div>
        <div class="sign">
            <div class="line-sign"></div>
            Manager Training & Development
        </div>
    </div>

    <div class="footer">
        Dokumen ini dicetak otomatis oleh sistem pelatihan online PT SSI
    </div>

</div>

</body>
</html>
`;

const w = window.open("", "_blank", "width=1200,height=850");
w.document.write(cert);
w.document.close();
w.focus();
w.print();
}
</script>


</body>
</html>
