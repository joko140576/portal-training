<!-- DESKRIPSI -->
<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<title>Pelatihan PT SSI</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<!-- BOOTSTRAP 5 -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- BOOTSTRAP ICONS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

<style>
body {
    background: linear-gradient(to bottom right, #fff8e6, #f6e7c5);
    font-family: 'Segoe UI', sans-serif;
}
.mainbox { max-width: 1200px; margin:auto; }
.card { border-radius:16px; border:none; }
.card-header {
    background:#d4af37;
    color:#fff;
    font-weight:600;
    border-radius:16px 16px 0 0;
}
.hidden{display:none}
.soal-box{
    background:#fff;
    padding:18px;
    border-radius:12px;
    border:1px solid #e3d7ac;
    margin-bottom:15px;
}
#loadingOverlay{
    position:fixed;
    inset:0;
    background:rgba(255,255,255,.85);
    display:none;
    justify-content:center;
    align-items:center;
    z-index:9999;
}
</style>
</head>

<body>

<!-- LOADING -->
<div id="loadingOverlay">
    <div class="text-center">
        <div class="spinner-border"></div>
        <p class="mt-3 fw-bold">Mengambil soal...</p>
    </div>
</div>

<div class="container mainbox py-5">

    <!-- JUDUL -->
    <div class="text-center mb-4">
        <h3 class="fw-bold text-success">
            <i class="bi bi-mortarboard-fill me-2"></i>
            Pelatihan Online PT SSI
        </h3>
        <h5 class="text-muted">
            <i class="bi bi-journal-text me-1"></i>
            Module Mesin ATM Hyosung 
        </h5>
    </div>

    <!-- FORM PESERTA -->
    <div id="formPeserta" class="card shadow-lg border-0">

        <div class="card-header bg-success text-white fw-bold">
            <i class="bi bi-person-vcard me-2"></i>
            Data Peserta
        </div>

        <div class="card-body p-4">

            <!-- NAMA -->
            <div class="mb-3">
                <label class="form-label fw-semibold">
                    <i class="bi bi-person-fill me-1 text-success"></i>
                    Nama Pegawai
                </label>
                <input id="nama" class="form-control" placeholder="Nama Pegawai">
            </div>

            <!-- NPP -->
            <div class="mb-3">
                <label class="form-label fw-semibold">
                    <i class="bi bi-credit-card-2-front-fill me-1 text-success"></i>
                    NPP
                </label>
                <input id="npp" class="form-control" placeholder="NPP">
            </div>

            <!-- REGION -->
            <div class="mb-3">
                <label class="form-label fw-semibold">
                    <i class="bi bi-geo-alt-fill me-1 text-success"></i>
                    Region
                </label>
                <select id="region" class="form-select">
                    <option value="">-- Pilih Region --</option>
                    <option>1</option><option>2</option><option>3</option><option>4</option><option>5</option>
                    <option>6</option><option>7</option><option>8</option><option>9</option><option>10</option>
                </select>
            </div>

            <!-- UNIT -->
            <div class="mb-3">
                <label class="form-label fw-semibold">
                    <i class="bi bi-building-fill me-1 text-success"></i>
                    Unit
                </label>
                <input id="unit" class="form-control" placeholder="Unit (contoh: TWU Bekasi)">
            </div>

            <!-- JABATAN -->
            <div class="mb-4">
                <label class="form-label fw-semibold">
                    <i class="bi bi-briefcase-fill me-1 text-success"></i>
                    Jabatan
                </label>
                <select id="jabatan" class="form-select">
                    <option value="">-- Jabatan --</option>
                    <option>GM</option>
                    <option>Ceo Region</option>
                    <option>Deputy</option>
                    <option>Senior Manager</option>
                    <option>Manager</option>
                    <option>Asisten Manager</option>
                    <option>Staf</option>
                </select>
            </div>

            <!-- BUTTON -->
            <button 
                class="btn btn-warning w-100 fw-bold py-2 shadow-sm"
                onclick="mulaiPostTest()">
                <i class="bi bi-play-circle-fill me-2"></i>
                Mulai Post Test
            </button>

        </div>
    </div>

</div>


<!-- KUIS -->
<div id="kuisBox" class="hidden mt-4">
<div class="card shadow">
<div class="card-header">Post Test</div>
<div class="card-body">
<div id="listSoal"></div>
<button class="btn btn-primary w-100 fw-bold" onclick="kumpulkan()">Kumpulkan Jawaban</button>
</div>
</div>
</div>

<!-- HASIL -->
<div id="hasilBox" class="hidden mt-4 card shadow p-4 text-center">
<h4 id="tampilNilai"></h4>
<button id="btnCetak" class="btn btn-warning mt-3 hidden" onclick="cetakSertifikat()">Cetak Sertifikat</button>
<button id="btnUlang" class="btn btn-danger mt-3 hidden" onclick="ulangKuis()">Ulangi Post Test</button>
</div>

</div>

<script>
const WEBAPP = "https://script.google.com/macros/s/AKfycbyVjaf9JMKBvhh1xTT9qAeK8OLtOAwbIYbe3exWNjEmLUJaLOJ5WPzJ52EJLjtdmI9q/exec";

const formPeserta = document.getElementById("formPeserta");
const kuisBox = document.getElementById("kuisBox");
const hasilBox = document.getElementById("hasilBox");
const btnCetak = document.getElementById("btnCetak");
const btnUlang = document.getElementById("btnUlang");
const tampilNilai = document.getElementById("tampilNilai");
const listSoal = document.getElementById("listSoal");
const loadingOverlay = document.getElementById("loadingOverlay");

let DATA_SOAL = [];
let USER = {};

async function mulaiPostTest(){
    USER.nama = nama.value;
    USER.npp = npp.value;
    USER.region = region.value;
    USER.unit = unit.value;
    USER.jabatan = jabatan.value;

    if(!USER.nama || !USER.npp){
        alert("Nama & NPP wajib diisi");
        return;
    }

    fetch(WEBAPP+"?action=simpandata",{method:"POST",body:JSON.stringify(USER)});
    formPeserta.classList.add("hidden");
    loadingOverlay.style.display="flex";

    const res = await fetch(WEBAPP+"?action=getsoal");
    DATA_SOAL = await res.json();

    let html="";
    DATA_SOAL.forEach((s,i)=>{
        html+=`
        <div class="soal-box">
            <b>${i+1}. ${s.soal}</b><br><br>
            ${["A","B","C","D"].map(p=>`
                <label class="d-block">
                <input type="radio" name="soal${i}" value="${p}">
                ${p}. ${s["opsi"+p]}
                </label>
            `).join("")}
        </div>`;
    });

    listSoal.innerHTML = html;
    loadingOverlay.style.display="none";
    kuisBox.classList.remove("hidden");
}

function kumpulkan(){
    let benar=0;
    DATA_SOAL.forEach((s,i)=>{
        const j=document.querySelector(`input[name=soal${i}]:checked`);
        if(j && j.value===s.kunci) benar++;
    });

    USER.nilai = Math.round((benar/DATA_SOAL.length)*100);
    fetch(WEBAPP+"?action=simpannilai",{method:"POST",body:JSON.stringify(USER)});

    kuisBox.classList.add("hidden");
    hasilBox.classList.remove("hidden");
    tampilNilai.innerHTML=`Nilai Anda: <b>${USER.nilai}</b>`;

    btnCetak.classList.add("hidden");
    btnUlang.classList.add("hidden");

    USER.nilai>=70 ? btnCetak.classList.remove("hidden") : btnUlang.classList.remove("hidden");
}

function ulangKuis(){
    hasilBox.classList.add("hidden");
    document.querySelectorAll("input[type=radio]").forEach(r=>r.checked=false);
    kuisBox.classList.remove("hidden");
}


function cetakSertifikat() {

const cert = `
<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Sertifikat Kelulusan</title>

<style>
@page {
    size: A4 landscape;
    margin: 0;
}

* {
    box-sizing: border-box;
}

body {
    margin: 0;
    padding: 0;
    height: 100vh;
    font-family: "Georgia", "Times New Roman", serif;
    background: 
        linear-gradient(rgba(0,0,0,0.35), rgba(0,0,0,0.35)),
        url("https://unsplash.com/photos/3d-rendering-of-earth-futuristic-technology-abstract-background-illustration-W5AgncO6FOU");
    background-size: cover;
    background-position: center;
}

/* CONTAINER SERTIFIKAT */
.certificate {
    width: 100%;
    height: 100vh;
    padding: 70px;
    background: rgba(255, 255, 255, 0.92);
    backdrop-filter: blur(6px);
    border: 18px solid #d4af37;
    outline: 6px double #b8963d;
    text-align: center;
    position: relative;
}

/* TITLE */
.title {
    font-size: 52px;
    color: #b08a2e;
    font-weight: bold;
    letter-spacing: 4px;
    margin-top: 20px;
}

.subtitle {
    font-size: 18px;
    color: #555;
    margin-top: 12px;
}

/* GARIS EMAS */
.line {
    width: 65%;
    height: 3px;
    background: linear-gradient(to right, transparent, #d4af37, transparent);
    margin: 30px auto;
}

/* NAMA PESERTA */
.name {
    font-size: 62px;
    font-weight: bold;
    color: #7a5a18;
    margin: 30px 0 20px;
    text-transform: uppercase;
    letter-spacing: 2px;
}

/* INFO */
.info {
    font-size: 20px;
    color: #333;
    line-height: 1.9;
}

/* NILAI */
.score {
    font-size: 22px;
    margin-top: 28px;
    color: #000;
}

.score span {
    display: inline-block;
    margin-top: 8px;
    font-size: 38px;
    font-weight: bold;
    color: #b08a2e;
}

/* TANDA TANGAN */
.signature-area {
    margin-top: 80px;
    display: flex;
    justify-content: space-between;
    padding: 0 120px;
}

.sign {
    text-align: center;
    font-size: 16px;
    color: #333;
}

.sign .line-sign {
    width: 240px;
    height: 1.5px;
    background: #333;
    margin: 45px auto 10px;
}

/* FOOTER */
.footer {
    position: absolute;
    bottom: 30px;
    left: 0;
    right: 0;
    text-align: center;
    font-size: 14px;
    color: #666;
}
</style>
</head>

<body>

<div class="certificate">

    <div class="title">SERTIFIKAT KELULUSAN</div>
    <div class="subtitle">Pelatihan Resmi PT Swadharma Sarana Informatika</div>

    <div class="line"></div>

    <div class="info">Dengan ini menyatakan bahwa:</div>

    <div class="name">${USER.nama}</div>

    <div class="info">
        NPP : <b>${USER.npp}</b><br>
        Region : <b>${USER.region}</b><br>
        Jabatan : <b>${USER.jabatan}</b>
    </div>

    <div class="score">
        Dinyatakan <b>LULUS</b> dengan nilai akhir
        <br>
        <span>${USER.nilai}</span>
    </div>

    
    <div class="footer">
        Dokumen ini dicetak otomatis oleh Sistem Pelatihan Online PT SSI
    </div>

</div>

</body>
</html>
`;

    const win = window.open("", "_blank");
    win.document.write(cert);
    win.document.close();
    win.focus();
    win.print();
}
</script>


</body>
</html>
