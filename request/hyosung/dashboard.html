<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Dashboard Hasil Pelatihan</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- BOOTSTRAP -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">

<style>
body{
    background:linear-gradient(to bottom right,#fff8e6,#f6e7c5);
    font-family:'Segoe UI',sans-serif
}
.mainbox{max-width:1200px;margin:auto}
.card{border-radius:18px;border:none}

/* LOADING OVERLAY */
#loadingOverlay{
    position:fixed;
    inset:0;
    background:rgba(255,255,255,.9);
    display:flex;
    justify-content:center;
    align-items:center;
    z-index:9999;
    animation:fadeIn .3s ease;
}
@keyframes fadeIn{
    from{opacity:0}
    to{opacity:1}
}
</style>
</head>

<body>

<!-- LOADING -->
<div id="loadingOverlay">
  <div class="text-center">
    <div class="spinner-border text-success" style="width:4rem;height:4rem"></div>
    <h5 class="mt-3 fw-bold text-success">Memuat Dashboard...</h5>
    <p class="text-muted">Mohon tunggu sebentar</p>
  </div>
</div>

<div class="container mainbox py-5">

<!-- JUDUL -->
<div class="text-center mb-4">
  <h3 class="fw-bold text-success">
    <i class="bi bi-bar-chart-fill me-2"></i> Dashboard Hasil Pelatihan
  </h3>
  <p class="text-muted">Rekap nilai peserta training PT SSI</p>
</div>

<!-- DASHBOARD -->
<div class="card shadow-lg">
<div class="card-header bg-success text-white fw-bold">
<i class="bi bi-speedometer2 me-2"></i> Statistik Peserta
</div>

<div class="card-body">

<div class="row text-center mb-4">
<div class="col-md-6">
<h6>Total Peserta</h6>
<h2 id="totalPeserta">0</h2>
</div>
<div class="col-md-6">
<h6>Rata-rata Nilai</h6>
<h2 id="rataNilai">0</h2>
</div>
</div>

<div class="table-responsive">
<table class="table table-bordered table-hover align-middle">
<thead class="table-success text-center">
<tr>
<th>Nama</th>
<th>NPP</th>
<th>Region</th>
<th>Unit</th>
<th>Jabatan</th>
<th>Nilai</th>
</tr>
</thead>
<tbody id="tabelDashboard"></tbody>
</table>
</div>

</div>
</div>

</div>

<script>
/* ================= CONFIG ================= */
const WEBAPP="https://script.google.com/macros/s/AKfycbyNx9JVritZPAE6LGKANhLVLhIZTAJVsQ8diLisTc7aQzDn3mXcWzrJlAHoQ9nhptFe/exec";

/* ================= DASHBOARD JSONP ================= */
function tampilDashboard(res){
    totalPeserta.innerText=res.totalPeserta;
    rataNilai.innerText=res.rataRata;

    tabelDashboard.innerHTML="";
    res.data.forEach(p=>{
        tabelDashboard.innerHTML+=`
        <tr class="text-center">
            <td class="text-start">${p.nama}</td>
            <td>${p.npp}</td>
            <td>${p.region}</td>
            <td>${p.unit}</td>
            <td>${p.jabatan}</td>
            <td class="fw-bold text-success">${p.nilai}</td>
        </tr>`;
    });

    // HILANGKAN LOADING SETELAH DATA MASUK
    document.getElementById("loadingOverlay").style.display="none";
}

/* ================= LOAD DASHBOARD ================= */
(function loadDashboard(){
    const s=document.createElement("script");
    s.src=WEBAPP+"?action=dashboard&callback=tampilDashboard";
    document.body.appendChild(s);
})();
</script>

</body>
</html>
